\documentclass[12pt,a4paper]{ctexart}

\input{mcmpreface}
%\includeonly{}
\newcommand{\papertitle}{基于动态规划方法的校车安排模型}%*****************************这里写论文题目****************************************
%文章中有两处需要论文题目，正文开始处（摘要前）和第一页。


%\etex -output-directory=E:/doc/2009nwumcm/paper
\begin{document}
\begin{CJK}{GBK}{song}
\input{declaration}

\makepapertitle
\begin{cnabstract}
%****************************************************************这里写摘要*******************************************

本文基于图论中的~floyd-Warshell~算法，使用动态规划的方法对校车安排问题进行建模和求解计算。模型的求解主要是对各种可能的情况进行遍历。

通过严格的数学推导证明乘车点选在小区内的满意度高于选在两个小区之间。

结合校车安排问题的实际情况，在模型建立与求解过程中提出一系列可以减少算法时间复杂度的优化方法。如果处理为普通的规划问题，
然后用数学软件求解，人数、乘车点数等变量大多都是整数变量，且数据量大，数学软件求解整数规划问题的本质也是遍历，
而且仅能从数学上进行优化。 算法时间复杂度依然较大。

在模型的建立与求解过程中，将问题全部转化为矩阵的形式，思路简单，编程时算法容易实现。

问题三中，以满意度方差最小为目标函数，使得尽可能多的人满意，且尽量公平。

满意度主要是是对比中产生的，主观因素影响较大。问题三中的满意度模型借鉴降半哥西分布时间满意度函数，通过敏感系数$
\beta$对主观因素进行定量化描述。与三角函数等其他形式的函数相比，可以把主观因素的变化情况更好的体现出来。

求解结果：


\begin{tabular}{|c|c|c|c|}
\hline
\multicolumn{2}{|c|}{} &设立站点&最短路\\
\hline 第一问&n=2&18,31&24492\\
\cline{2-4}&n=3&15,21,31&19660\\
\hline
第二问&n=2&19,32&1242935\\
\cline{2-4}&n=3&15,21,32&972800\\
\hline \multicolumn{2}{|c|}{第三问}&\multicolumn{2}{|c|}{15,21,32}\\
\hline
\end{tabular}


%****************************************************************摘要结束*********************************************
\keyword{~floyd-Warshell~,动态规划,敏感系数，算法时间复杂度，矩阵}%***********************************************这里写关键词，用“，”隔开**********************************
\end{cnabstract}

\tableofcontents\newpage
%E:\doc\nwumcm\paper
\input{chongshu}%写好后无需修改，放在一个文件内即可。************************************
\input{SupposeAndSymbol}%假设和符号设定写好后无需调试查看效果，所以可以放到一个文件中。**

%模型分析，建立和求解后需要反复修改，若单独放在一个文件中，写好后需回到主文件编译，不方便。
\section{问题分析}

%先综述主要分析过程，然后详细分析，主要涉及 乘车点能否选在区域间的问题。
本题主要是针对如何有效的安排校车问题进行建模。

影响乘车站点设立的因素很多，例如，小区到站点的距离；
各小区到某站点乘车的人员数目；
%因为小区与小区人员分布不均匀，设置站点时我需考虑到把站点尽量设置到人员较多的小区附近；
每个站点可以安排的车辆数；发车时间；车启动后的行驶路线等因素。

不考虑车启动后的问题，只需研究乘客上车前的因素对站点设立的影响。

\subsection{第一问}


问题一的模型中，我们仅考虑小区到站点的距离对站点设置的影响。
即，如何建立n个乘车点，使得各小区到最近乘车点的距离之和最短。
问题的实质就是已知一个有~50~个顶点的图，在图中建立$n$个乘车点，类似图论中的最短论问题。

乘车点只能建立在顶点上，详细证明见\ref{sec:points}

在这~50~个小区中挑选出~n~个小区作为乘车站点，共有$\,C_{50}^{n}\,$种取法，
求出每种取法最短路径之和，其中和最小的方案即为目标方案。

用~Floyd-Warshell~算法可以求出任意两个区域间的最短路径。

\subsection{第二问}

对于一个小区来说，距离它最近的乘车站点是确定的，而且如果某个小区有人放弃最近的乘车点而去别的乘车点，
这必然导致满意度降低。

最近乘车点是确定的，但不一定唯一。有可能两个站点距离相等。这种概率很小，我们认为是不存在的。
因此我们在此问题中不考虑同一个小区的人员区不同的站点乘车这种情况。

我们认为影响满意度的因素主要是所有人实际行走距离的总和，二者是负相关的关系。
因此，我们主要考虑小区到乘车点的加权距离，此处的权为人数。

算法同第一问。只需将最短路矩阵修正为赋权最短路矩阵。

\subsection{第三问}

与第二问中对满意度要求不同的是，这里要求使得教职工尽量满意，而并非单纯的最大程度满意；
两方面条件：一是总体满意度要高：二是满意的人数要多，满意度的方差小。

此处的满意度主要受到主观因素（人与人之间的攀比心理）和客观因素（小区到站点的距离）的影响。

有两种方法对整体满意度的影响：
\begin{itemize}
\item 区间法

假定a是一个满意度的微小量，总体满意度$$S_{total}=\sum_{i=1}^{50}\sum_{j=1}^{3}S_{i,j}$$
则总体满意度的变化范围是$[S_{total}-a,S_{total}+a]$。

\item 方差法

T=$\sum_{i=1}^{50}\sum_{j=1}^{3}(S_{i,j}-ave)^2$ 其中T是方差。
\end{itemize}
我们通过比较，可以发现方差能够很好表示满意度随着站点不同而具有的涨落，
而平均满意度是整体满意度的和与站点个数的比值，是一个定值，与站点的选取没有关系。
因此我们在评价满意度微小波动时采用方差来评价。

\section{模型建立}

\subsection{乘车点只能建立在顶点上（即小区内）}\label{sec:points}

%----------------------------------图形大小未设置好---------------------------------------------
\begin{center}
\begin{figure}
\includegraphics[scale=1,bb=0 0 100 150]{points}
\caption{乘车点设在区域内}\label{fig:points}
\end{figure}
\end{center}
%************************************************************************************************
%假设在该问题中只考虑距离因素，不考虑乘车人数对设立乘车站点的影响。
图\ref{fig:points}中，点代表区域。
$n_a$表示与小区~A~相连的所有路径的总数，$n_b$表示与小区~B~相连的所有路径的总数，
现考虑在~A~B~点间之间设置一个乘车点~C~，使得它到各个区域最短距离之和最小。

假设站点~C~设置到距小区~A~的距离为~x~处，
~AB~间的距离为$\,s\,$。各个小区到乘车点~C~必然经过~A~或者~B~，对于从~a~点来的乘客去车站需要走的路程为$\,n_a\cdot{}x\,$，同理，
从~B~点来的乘客到车站需要走的路程为$\,n_b\cdot(s-x)\,$，则，各个小区到乘车点~C~站点的所有路程之和为

\begin{eqnarray}
 d &=& n_a\cdot{}x+ n_b\cdot(s-x)\\
&=&n_b\cdot s+(n_a-n_b)x
\end{eqnarray}

数学模型为

\begin{eqnarray}
min:&&d=n_b\cdot s+(n_a-n_b)x\\
s.t.&&\\
&&x\in[0,s]
\end{eqnarray}

若$\,n_a<n_b$,则$\,x=s$时，$d\,$取最小值。站点设在~B~处。

若$\,n_a>n_b$,则$\,x=0$时，$d\,$取最小值。站点设在~A~处。

若$\,n_a=n_b$,则$d$为常数。站点设在~AB~间的任意位置。

综合考虑，乘车点应设置在小区内。

\subsection{~floyd-warshell~算法求最短路径矩阵$\,P_{i,j}$}

floyd-warshell~算法的基本思想是：递推产生一个矩阵序列$P_0,P_1,P_2,\cdots,P_n$，其中$P_k(i,j)$表示从顶点$v_i$到顶点$V_j$的路径上所经过的顶点序号不大于$k$的最短路径长度。
计算时用迭代公式：$$P_k(i,j)=min(P_{k}(I,j),P_{k-1}(i,j)+P_{k-1}(k,j))$$

$k$是迭代次数，$i,j,k=1,2,,\cdots,n$。

最后，当$k=n$时，$A_n$即是各顶点之间的最短通路值。

$P_{i,j}$是一个无向赋权图

\subsection{第一问}

在这~50~个小区中挑选出~n~个小区作为乘车站点，共有$\,C_{50}^{n}\,$种取法。
对于选定的取法，由最短路矩阵$\,P_{i,j}\,$可以得到小区~j~到各个站点~i~的最短路矩阵$S_{i,j}$
矩阵$S_{i,j}$各列的最小值即为小区~j~到最近站点~i~的最短路。

具体算法如下；

step1:由~floyd-warshell~算法求最短路径矩阵$P_{i,j}$

step2:选择n个小区作为乘车点，构建$n\times50$的矩阵$S_{i,j}$，矩阵每一列的最小值为$S_j$。
该方案的最短路径$$P_i=\sum_{j=1}^{50} S_i$$

step3:重复~step2~，直到遍历所有可能的组合方式。

step4:使得$P_i,\text{其中，}i=1,2,3,\ldots,50$取最小值的方案即为最佳方案。

\subsection{第二问}

定义新的赋权最短路矩阵$\,Q_{i,j}\,$

$$Q_{i,j}=P_{i,j}\times N_{i}$$

其中，$Q_{i,j}$表示第~i~小区到第~j~小区的赋权最短路，$N_{i}$表示第
~i~小区的总人数。$Q_{i,j}$是一个有向赋权图。

具体算法同第一问，修正后算法如下；

step1:由最短路径矩阵$P_{i,j}$构建赋权最短路矩阵$Q_{i,j}$

step2:选择n个小区作为乘车点，构建$n\times50$的矩阵$S'_{i,j}$，矩阵每一列的最小值为$S'_j$。
该方案的最短路径$$Q_i=\sum_{j=1}^{50} S'_i$$

step3:重复~step2~，直到遍历所有可能的组合方式。

step4:使得$Q_i,\text{其中，}i=1,2,3,\ldots,50$取最小值的方案即为最佳方案。

\subsection{第一、二问的模型求解}

使用~maltab~编程，结果如下：

\begin{tabular}{|c|c|c|c|}
\hline
\multicolumn{2}{|c|}{} &设立站点&最短路\\
\hline 第一问&n=2&18,31&24492\\
\cline{2-4}&n=3&15,21,31&19660\\
\hline
第二问&n=2&19,32&1242935\\
\cline{2-4}&n=3&15,21,32&972800\\
\hline
\end{tabular}

\subsection{第三问的模型建立与求解}

\subsubsection{构建满意度函数}

给定的网络$\,G(V,A)\,$中，$V(|V|=m)$ 为顶点集，A为边。

$S(P_{\,i,j}\,)\,$表示第~i~个小区的人到~j~站点的满意度。其中，$P_{i,j}\,$表示~i~小区到~j~站点的最小距离。
$i\in{}V,j\in{}V$。%~i~和~j~分别表示小区和乘车点集合的下标，
乘客的满意度~S~与$\,P_{i,j}\,$成负相关的关系.

令，$L_i$为第i个小区的乘客感到非常满意时所能接受的小区到车站的最长距离，
$U_i$表示第i个小区的乘客感到非常不满意时该小区到车站的最短距离。

当$$P_{i,j}<L_i$$时，认为在距离小于$L_i$的区域内，所有的乘客对站点~j~的满意程度是一样的。

当$$P_{i,j}>L_i$$时，随着$\,P_{i,j}$增加，满意度降低，即满意度函数$S(P_{i,j})$成负相关关系。

%$$S_{i,j}\propto[Pij(Pij-Li)]$$，

于是，我们可以构造满意度函数$S(P_{i,j})$。

当$(Li-P_{i,j})\geq0$时，$$S(P_{i,j})=1$$

当$(L_i-P_{i,j})<0$时，$$S(P_{i,j})=\frac{1}{1+P_{i,j}(P_{i,j}-L_i)\beta}$$

其中，$\beta$是敏感度系数。类似于降半哥西分布时间满意度函数。
影响该满意度函数的因素我们这里只考虑主观因素（人与人之间的攀比）和客观因素（站点到小区的距离），
而忽略其他次要因素，其中敏感系数$\beta$就代表了主观因素。

该函数与余弦函数相比，可以把满意度函数随敏感系数(即主观因素)的变化情况比较明显的体现出来。

\subsubsection{方案的初选}

问题三的是一个多目标规划问题，整体满意度高，满意度方差小。

我们将其转化为单目标规划问题。即，在整体满意度大于某一个阈值的前提下，满意度方差最小的方案。

目标函数$$min:\sum_{i,j}(S_{i,j}-ave)^2$$其中，$S_(i,j)$表示小区i到j的满意度。$ave$是$S_(i,j)$矩阵的平均值。

$$\sum_{i,j}S_{i,j}>S_0$$作为一个约束。其中，$S_0$是整体满意度的阈值。

做成一个动态规划的问题可以有效的降低算法的时间复杂度。

应用第二问的模型我们可以对整体满意度由高到低进行排序，取出排名靠前的a种方案。
这些方案并未考虑乘车点的接纳能力问题，由于每辆车最多坐47人，到某乘车点的总人数不是47的倍数概率极大，
为了使得每辆车充分利用，因此我们需要对这些多出来的人员进行重新分配。然后在这些方案中找出满意度方差改变最小的方案即可。

\subsubsection{人员重新分配模型}

对于一个选定的组合，未重新分配时，到三个站点的总人数矩阵为$Num$，$Num$是一行三列的矩阵。
$$mod=mod(Num,47)$$
$Num$对47取余数得mod矩阵。对mod重新规划即可。

如果调整，最优方案是对整体方差影响最小的方案。

人员分配模型仅对小部分数据进行，所以，第二阶段对整体满意度平均值的影响可以忽略，
假定第二阶段规划后整体满意度的平均值不变。

由第二问的模型可得$n\times50$的矩阵$T_{i,k}$，$T_{i,k}$表示乘车点~i~到小区~k~的满意度。
令，$$\varepsilon_{i,j}=|T_{i,k}-T_{j,k}|$$

遍历$k$从~1~到~50~，
使得$\varepsilon_{i,j}$取最小值的k值赋值给$R_{i,j}$。

构建$3\times3\text{的矩阵}\,R_{i,j}$，$\,R_{i,j}\,$的表示，如果要将原到乘车点~i~的人调整到乘车点~j~，则调小区~k~的人。

人员重新分配有四种可能。

\begin{itemize}
\item 增加3辆车，不需要重新规划。每个乘车点增加一辆

\item 增加2辆车。即将其中一个乘车点的人调整到另外两个站点。
\item 增加1辆车。即将两个乘车点的人调整到第三个乘车点。
\item 不增加车。概率基本为零。忽略这种情况。
\end{itemize}

对于每种情况利用矩阵$\,R_{i,j}\,$分别遍历即可。$\,R_{i,j}\,$矩阵很小,所以,遍历的算法时间复杂度很小。

\subsubsection{方案的选择}\label{sec:fenxi}

对调整后的方案求方差，方差最小的即为最优方案。按车数分成三类进行计算。

显然，对人员调整的越多，满意度下降越明显。

增加3辆车，人员调整最小，满意度最高。

增加2辆车，人员调整居中，满意度居中。

增加1辆车，人员调整最大，满意度最低。

所以，如果更关心满意度，则增加3辆车，如果更关心成本，增加1辆车，如果二者都要兼顾，则增加两辆车。

\subsubsection{第三问模型的求解}

本题要求尽量满意，则应增加三辆车。第二问$n=3$的结果即为本题的结果。在15，21，32处设立站点。

对模型进行定性分析即可，不需要求解模型即可得到结果。详细分析见\ref{sec:fenxi}

\subsubsection{第四问}

很显然，乘车人员的满意度和运行成本之间会有相互制约，即，有可能出现乘车人员的满意度很高，
但是运行成本也很高的情况。我们如果能找出满意度和运行成本之间的函数关系，
我们还可以用每天所发的总车次数以及平均每车次的载客率为目标函数，再添加其他固定的约束条件，
用多个函数共同来协调工作，这样来找出降低成本的方法更贴合实际，更为准确，
但是，满意度函数仍然起到最主要的作用。这里的运行成本应当包含在各站点安排的车辆数目、
每辆车每天往返于新老校区的次数。我们忽略了时间因素，比如，发车时间，中途停车时间；
此外，还有人的主观因素，比如，教师与工作人员无差异，司机的技术等。



\input{pingjia}

%\bibliography{E:/doc/latex_jabref/jakungref}%\nocite{expgjining}

\begin{thebibliography}{1}
\bibitem{1} http://search.cpan.org/search?query=Graph\&mode=all
\bibitem{2} http://alexle.net/stuff/floyd-algorithm/
\bibitem{3}物流设施选址问题中时间满意度函数的定义及应用
马云峰，张敏,杨裙 (华中科技大学管理学院，湖北武汉430074 )
\end{thebibliography}

%维基百科

\end{CJK}
\end{document}
